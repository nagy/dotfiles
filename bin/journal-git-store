#!/bin/sh
set -exo pipefail

BOOTID=${BOOTID:-"$(tr -d - < /proc/sys/kernel/random/boot_id)"}
HOSTNAME=${HOSTNAME:-"$(hostname --short)"}
TAGNAME=$(date +$HOSTNAME/%Y-%m-%d_%H-%M-%S/$BOOTID)

bootlog_json() {
   journalctl --boot="$BOOTID" --output=json \
       | jq --compact-output --sort-keys
}
hash=$(bootlog_json | git hash-object -w --stdin)
git tag -f $TAGNAME $hash
